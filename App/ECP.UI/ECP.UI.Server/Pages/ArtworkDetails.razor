@page "/artwork/{ArtworkId:int}/{SourceId:int}"
@inject ArtworkService ArtworkService
@using ECP.UI.Server.Components.Error
@using ECP.UI.Server.Components.Shared

@if (isLoading)
{
    <div class="d-flex justify-center align-center" style="height: 100vh;">
        <MudProgressCircular Color="Color.Primary" Indeterminate="true" Size="Size.Large" />
    </div>
}
else if (_artwork != null)
{
    <MudGrid Class="pa-4">
        <!-- Main artwork image and details layout -->
        <MudItem xs="12" sm="6" Class="d-flex justify-center">
            @if (!string.IsNullOrEmpty(_artwork.Images?.Thumbnail?.Url))
            {
                <MudImage Src="@_artwork.Images.Thumbnail.Url" Alt="@_artwork.Title"
                          Class="rounded-lg shadow-lg"
                          Style="max-width: 100%; height: auto;"/>
            }
            else
            {
                <MudImage Src="https://placehold.co/600x400/2c3e50/ecf0f1?text=Image+Not+Found"
                          Alt="Image Not Found"
                          Class="rounded-lg shadow-lg"
                          Style="max-width: 100%; height: auto;"/>
            }
        </MudItem>

        <!-- Artwork information section -->
        <MudItem xs="12" sm="6">
            <MudCard Outlined="true" Elevation="4">
                <MudCardHeader>
                    <CardHeaderContent>
                        <MudText Typo="Typo.h3">@_artwork.Title</MudText>
                        @if (_artwork.Artists != null && _artwork.Artists.Any())
                        {
                            <MudText Typo="Typo.h5" Class="mt-2">
                                @string.Join(", ", _artwork.Artists.Select(a => a.Name))
                            </MudText>
                        }
                    </CardHeaderContent>
                </MudCardHeader>
                <MudDivider/>
                <MudCardContent>
                    <MudText Typo="Typo.body1" Class="mb-4">
                        <strong>Creation Date:</strong> @_artwork.CreationDate
                    </MudText>
                    <MudText Typo="Typo.body1" Class="mb-4">
                        <strong>Medium:</strong> @_artwork.Medium
                    </MudText>
                    @if (_artwork.Dimensions != null)
                    {
                        <MudText Typo="Typo.body1" Class="mb-4">
                            <strong>Dimensions:</strong>
                            @(_artwork.Dimensions.Width) x @(_artwork.Dimensions.Height) cm
                            @if (_artwork.Dimensions.Depth.HasValue)
                            {
                                @($" x {_artwork.Dimensions.Depth.Value} cm")
                            }
                        </MudText>
                    }
                    @if (!string.IsNullOrWhiteSpace(_artwork.Description))
                    {
                        <MudText Typo="Typo.body2" Class="mb-4">
                            <div class="mt-4" style="text-align: justify;" >
                                @_artwork.Description
                            </div>
                        </MudText>
                    }
                    @if (_artwork.Subjects != null && _artwork.Subjects.Any())
                    {
                        <MudList T="string">
                            <MudListItem>
                                <MudText Typo="Typo.h6">Subjects</MudText>
                                @foreach (var subject in _artwork.Subjects)
                                {
                                    <MudChip Label="true" Color="Color.Primary" Class="ma-1">@subject</MudChip>
                                }
                            </MudListItem>
                        </MudList>
                    }
                    @if (_artwork.Styles != null && _artwork.Styles.Any())
                    {
                        <MudList T="string">
                            <MudListItem>
                                <MudText Typo="Typo.h6">Styles</MudText>
                                @foreach (var style in _artwork.Styles)
                                {
                                    <MudChip Label="true" Color="Color.Secondary" Class="ma-1">@style</MudChip>
                                }
                            </MudListItem>
                        </MudList>
                    }
                </MudCardContent>
                @if (!string.IsNullOrEmpty(_artwork.SourceUrl))
                {
                    <MudCardActions Class="d-flex justify-end">
                        <MudButton Href="@_artwork.SourceUrl" Target="_blank" Variant="Variant.Filled" Color="Color.Primary">
                            View Source
                        </MudButton>
                    </MudCardActions>
                }
            </MudCard>
        </MudItem>
    </MudGrid>
}
else
{
    <NotFoundMessage></NotFoundMessage>
}

@code {
    [Parameter]
    public int ArtworkId { get; set; }

    [Parameter]
    public int SourceId { get; set; }

    private Artwork _artwork = null;
    private bool isLoading = true;

    protected override async Task OnParametersSetAsync()
    {
        isLoading = true;
        _artwork = null;

        try
        {
            var response = await ArtworkService.GetArtworkByIdAsync(ArtworkId, SourceId);

            if (response.IsSuccess)
            {
                _artwork = response.Value;
            }
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Error fetching artwork: {ex.Message}");
            _artwork = null;
        }
        finally
        {
            isLoading = false;
        }


    }
}
